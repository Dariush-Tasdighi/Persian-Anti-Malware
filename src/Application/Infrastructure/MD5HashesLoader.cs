using System.Linq;

namespace Infrastructure;

internal static class MD5HashesLoader : object
{
	static MD5HashesLoader()
	{
	}

	public static async System.Threading.Tasks.Task LoadAsync()
	{
		if (System.IO.Path.Exists(path: ApplicationSettings.Path) == false)
		{
			System.IO.Directory.CreateDirectory
				(path: ApplicationSettings.Path);

			return;
		}

		var directoryInfo =
			new System.IO.DirectoryInfo
			(path: ApplicationSettings.Path);

		var files =
			directoryInfo.GetFiles()
			.Where(current => current.Extension.ToLower() == ".md5".ToLower())
			.OrderByDescending(current => current.Name)
			.Skip(count: 0)
			.Take(count: ApplicationSettings.LoadTop)
			.ToList()
			;

		foreach (var file in files)
		{
			var fileContent =
				await
				System.IO.File
				.ReadAllTextAsync(path: file.FullName);

			fileContent =
				fileContent.Replace("\r", string.Empty);

			var items =
				fileContent.Split('\n');

			foreach (var item in items)
			{
				MD5Hashes.Add(hashItem: item);
			}
		}
	}
}
